<?phpinclude("./config.php");include_once("./header.php");$PHP_SELF = $_SERVER['PHP_SELF'];$db = new CMySQL;$dataakt=date("Y-m-d");$dataakt2=date("d/m/Y");$tytul='New Temporaty staff';(!isset($_POST["state"])) ? $state = "0" : $state = $_POST["state"];(isset($_POST['edit'])) ? $edit=$_POST['edit'] : $edit="";(isset($_POST['ID'])) ? $ID=$_POST['ID'] : $ID="";if ($edit == "1") $tytul='Edit Temporary staff';if ($state == 0){echo "	<TD ALIGN=JUSTIFY VALIGN=TOP border=0>	<table width='100%' border=0><tr><td><center><form action='$PHP_SELF?edit=$edit&ID=$ID' method='post' name='ed_czl' ENCTYPE='multipart/form-data'>  <font class='FormHeaderFont'>$tytul</font>  <table border='0' cellpadding='3' cellspacing='1' class='FormTABLE'>"; if (!$db->Open()) $db->Kill();  $q = "SELECT MAX(ID) AS id FROM temp_nombers"; if (!$db->Query($q)) $db->Kill();  $no=$db->Row();$tempid=$no->id+1;if ($edit == "1") {$q = "SELECT `ID`, `pno`, `firstname`, `surname`, `knownas`, `status`, `cat`, DATE_FORMAT(`temp_nombers`.`started`, \"%d/%m/%Y\") as started, speciality, `photo_alttext`, `photo_src`, `photo_desc`, `photo_filename`, `photo_filesize`, `photo_filetype` FROM `temp_nombers` WHERE `ID`=$ID;"; if (!$db->Query($q)) $db->Kill();   $no=$db->Row(); $tempid="$no->ID";}    echo "$q";if (($no->cat == "c") Or ($no->cat == "") ) {$regtypetxt = " <option value=\"c\" selected>Casual</option>\n  <option value=\"r\">Regular</option>" ; }    else  {$regtypetxt = " <option value=\"c\">Casual</option>\n  <option value=\"r\"  selected>Regular</option>" ; } $q = "SELECT catozn,catname FROM emplcat"; if (!$db->Query($q)) $db->Kill();  $row=$db->Row(); $rstafftypehtml = " <option value=\"0\">Choose Regular Type!!!</option> \n ";while ($row=$db->Row())    {        if ($no->cat == $row->catozn) {     $rstafftypehtml .="<option value=\"$row->catozn\" selected>$row->catname</option>\n";     }     else  $rstafftypehtml .="<option value=\"$row->catozn\">$row->catname</option>\n";    }    echo "  <tr>      <td class='FieldCaptionTD'>The last temporary number is:</td>      <td class='DataTD'><B>$no->id</B></td>    </tr>    <tr>      <td class='FieldCaptionTD'>Temporary number</td>      <td class='DataTD'>$tempid<input TYPE='hidden'  name='_pno'  value='$tempid'></td>    </tr>    <tr>      <td class='FieldCaptionTD'>First name</td>      <td class='DataTD'><input class='Input' maxlength='20' onChange=\"this.form._knownas.value=this.value; this.form._surname.value=this.value;\" name='_firstname' value='$no->firstname'>      </td>    </tr>    <tr>        <td class='FieldCaptionTD'>Surname <B><FONT COLOR='#FF0000'>*</FONT></B></td>      <td class='DataTD'><input class='Input' maxlength='20' name='_surname' value='$no->surname'></td>    </tr>    <tr>      <td class='FieldCaptionTD'>Known as/TT name <B><FONT COLOR='#FF0000'>*</FONT></B></td>      <td class='DataTD'><input class='Input' maxlength='20' name='_knownas' size='20' value='$no->knownas'></td>    </tr>    <tr>      <td class='FieldCaptionTD'>Type</td>      <td class='DataTD'>      <select name=\"_stafftype\" id=\"stafftype\">    $regtypetxt  </select>      </td>    </tr>    <tr>      <td class='FieldCaptionTD'>Regular type</td>      <td class='DataTD'>        <select name=\"_rstafftype\" id=\"rstafftype\">      $rstafftypehtml    </select><input TYPE='hidden' maxlength='20' name='_status' size='20' value='TEMP'>      </td>    </tr>     <tr>      <td class='FieldCaptionTD'><B>Start date</B></td>      <td class='DataTD'><input class='Input' maxlength='20' name='_startdate' size='20' value='$no->started'> (dd/mm/yyyy)</td>    </tr>       <tr>      <td class='FieldCaptionTD'><B>Speciality</B></td>      <td class='DataTD'><input class='Input' maxlength='20' name='_speciality' size='25' value='$no->speciality'></td>    </tr>        <input name='state' type='hidden' value='1'>  <INPUT TYPE='hidden' NAME='MAX_FILE_SIZE' VALUE='2000000'><INPUT TYPE='hidden' NAME='_photo_filename' VALUE='$no->photo_filename'>  <TR>   <TD class='FieldCaptionTD'>ALT Text: </TD>   <TD class='DataTD'><TEXTAREA NAME='alt' ROWS='1' COLS='50'>$no->photo_alttext</TEXTAREA></TD>  </TR>  <TR>   <TD class='FieldCaptionTD'>Description: </TD>   <TD class='DataTD'><TEXTAREA NAME='des' ROWS='2' COLS='50'>$no->photo_desc</TEXTAREA></TD>  </TR>  <TR>   <TD class='FieldCaptionTD'>Photo: $no->photo_filename</TD>   <TD class='DataTD'><INPUT TYPE='file' NAME='src' value='Browse...'></TD>  </TR>  <TR>   <TD>	<input class='Button' name='Update' type='submit' value='$SAVEBTN'>			<input class='Button'  type='Button' onclick='window.location=\"stafflista_temp.php\"' value='$LISTBTN'></td>  </TR>  <tr>      <td class='DataTD' colspan='2'><B><FONT COLOR='#FF0000'>* - these are necessary</FONT></B></td>    </tr>  </TABLE> <input type=hidden name=submitted value=1>  <input type=hidden name=submitted value=1></form></center><BR></td></tr></table>";include_once("./footer.php");}elseif($state==1){   if (!$db->Open()) $db->Kill();      $_firstname = $db->Fix($_firstname);   $_surname = $db->Fix($_surname);   $_knownas = $db->Fix($_knownas);      if ($src!="") {     $data = addslashes(fread(fopen($src, 'r'), filesize($src)));   $opis = addslashes(nl2br($des));   }     if ($edit != "1") {      if ($_stafftype== "c") {   $query = ("INSERT INTO `temp_nombers` (  firstname, surname, knownas, status ,cat,started, speciality, `photo_alttext`, `photo_src`, `photo_desc`, `photo_filename`, `photo_filesize`, `photo_filetype`) VALUES (  '$_firstname', '$_surname', '$_knownas', '$_status', 'c', STR_TO_DATE( '$_startdate', '%d/%m/%Y') , '$_speciality','$alt', '$data', '$opis', '$src_name', '$src_size', '$src_type')") ;   if (!$db->Open()) $db->Kill();   $result = mysql_query($query);   echo "<script language='javascript'>window.location=\"stafflista_temp.php\"</script>";   }   elseif ($_stafftype== "r" && $_rstafftype!= "0") {   $query = ("INSERT INTO `temp_nombers` (  firstname, surname, knownas, status, cat, started, speciality, `photo_alttext`, `photo_src`, `photo_desc`, `photo_filename`, `photo_filesize`, `photo_filetype` ) VALUES ( '$_firstname', '$_surname', '$_knownas', '$_status', '$_rstafftype', STR_TO_DATE( '$_startdate', '%d/%m/%Y') , '$_speciality','$alt', '$data', '$opis', '$src_name', '$src_size', '$src_type')") ;   if (!$db->Open()) $db->Kill();  $result = mysql_query($query);   echo "<script language='javascript'>window.location=\"stafflista_temp.php\"</script>";   }   else echo "The casual / regular data are bad!";}else {if (!$db->Open()) $db->Kill();$q = "UPDATE `temp_nombers` SET `firstname` = '$_firstname',surname= '$_surname', knownas= '$_knownas', status= '$_status' ,cat= '$_rstafftype',started= STR_TO_DATE( '$_startdate', '%d/%m/%Y'), speciality= '$_speciality' Where ID =$ID"; if (!$db->Query($q)) $db->Kill();if ($_photo_filename != $src_name && $src_name!=="") {$q = "UPDATE `temp_nombers` SET `photo_alttext` = '$alt',`photo_src`= '$data', `photo_desc`= '$opis', `photo_filename`= '$src_name' ,`photo_filetype`= '$src_size',`photo_filetype`='$src_type' Where ID =$ID";if (!$db->Query($q)) $db->Kill();}echo "<script language='javascript'>window.location=\"stafflista_temp.php\"</script>";}} //if state=1else{ echo "<BR><BR><BR>Ostrzeï¿½enie!!!!!<BR><BR><BR>",	 "Ktos z komputera $REMOTE_ADDR probuje sie wlamac<BR>";} //else state?>