<?phpinclude("./config.php");include_once("./header.php");$PHP_SELF = $_SERVER['PHP_SELF'];$db = new CMySQL;$dataakt=date("Y-m-d");$dataakt2=date("d/m/Y");$tytul='New Temporaty staff';$edit=$_GET["edit"];$ID=$_GET["ID"]; if (!$db->Open()) $db->Kill();if ($edit == "1") $tytul='Copy Temporary to permanent staff';if(!isset($state)){echo "	<TD ALIGN=JUSTIFY VALIGN=TOP border=0>	<table width='100%' border=0><tr><td><center><form action='$PHP_SELF?edit=$edit&ID=$ID' method='post' name='ed_czl' ENCTYPE='multipart/form-data'>  <font class='FormHeaderFont'>$tytul</font>  <table border='0' cellpadding='3' cellspacing='1' class='FormTABLE'>";  $q = "SELECT MAX(ID) AS id FROM temp_nombers"; if (!$db->Query($q)) $db->Kill();  $no=$db->Row();$tempid=$no->id+1;if ($edit == "1") {$q = "SELECT `ID`, `pno`, `firstname`, `surname`, `knownas`, `status`, `cat`, DATE_FORMAT(`temp_nombers`.`started`, \"%d/%m/%Y\") as started, speciality, `photo_alttext`, `photo_src`, `photo_desc`, `photo_filename`, `photo_filesize`, `photo_filetype` FROM `temp_nombers` WHERE `ID`=$ID;"; if (!$db->Query($q)) $db->Kill();   $no=$db->Row(); $tempid="$no->ID";}    if (($no->cat == "c") Or ($no->cat == "") ) {$regtypetxt = "Casual" ; }    else  {$regtypetxt = "Regular" ; } $q = "SELECT catozn,catname FROM emplcat"; if (!$db->Query($q)) $db->Kill();  $row=$db->Row(); while ($row=$db->Row())    {    if ($no->cat == $row->catozn) {     $rstafftypehtml ="$row->catname";     }          }    echo "  <tr>      <td class='FieldCaptionTD'>The last temporary number is:</td>      <td class='DataTD'><B>$no->id</B></td>    </tr>    <tr>      <td class='FieldCaptionTD'>Temporary number</td>      <td class='DataTD'>$tempid<input TYPE='hidden'  name='_pno'  value='$tempid'></td>    </tr>    <tr>      <td class='FieldCaptionTD'>Clocking Number?</td>      <td class='DataTD'>      <input class='Input' maxlength='5' name='_clno' value=''></td>    </tr>        <tr>      <td class='FieldCaptionTD'>First name</td>      <td class='DataTD'>$no->firstname      </td>    </tr>    <tr>        <td class='FieldCaptionTD'>Surname <B><FONT COLOR='#FF0000'>*</FONT></B></td>      <td class='DataTD'>$no->surname</td>    </tr>    <tr>      <td class='FieldCaptionTD'>Known as/TT name <B><FONT COLOR='#FF0000'>*</FONT></B></td>      <td class='DataTD'>$no->knownas</td>    </tr>    <tr>      <td class='FieldCaptionTD'>Type</td>      <td class='DataTD'>          $regtypetxt        </td>    </tr>    <tr>      <td class='FieldCaptionTD'>Regular type</td>      <td class='DataTD'>              $rstafftypehtml    <input TYPE='hidden' maxlength='20' name='_status' size='20' value='TEMP'>      </td>    </tr>     <tr>      <td class='FieldCaptionTD'><B>Start date</B></td>      <td class='DataTD'>$no->started</td>    </tr>       <tr>      <td class='FieldCaptionTD'><B>Speciality</B></td>      <td class='DataTD'>$no->speciality</td>    </tr>    <tr>      <td class='FieldCaptionTD'><B>Copy Picture data</B></td>      <td class='DataTD'><input name='_copy' type='checkbox' id='checkbox1' value='1' /></td>    </tr>    <tr>      <td class='FieldCaptionTD'><B>Delete from Temporary List</B></td>      <td class='DataTD'><input name='_delete' type='checkbox' id='checkbox2' value='1' /></td>    </tr>           <td align='right' colspan='2'>		<input name='state' type='hidden' value='1'>			</td>    </tr>  <TR>   <TD>	<input class='Button' name='Update' type='submit' value='$SAVEBTN'>			<input class='Button'  type='Button' onclick='window.location=\"stafflista_temp.php\"' value='$LISTBTN'></td>  </TR> </TABLE> <input type=hidden name=submitted value=1>  <input type=hidden name=submitted value=1></form></center><BR></td></tr></table>";include_once("./footer.php");}elseif($state==1){   if (!$db->Open()) $db->Kill();   if ($_copy== "1") {       if ($_clno != "") {          $q = "SELECT pno FROM `nombers` Where pno=$_clno";    if (!$db->Query($q)) $db->Kill();      $row=$db->Row();      $rows = $db->Rows();  echo "sss $q -$rows- $_clno";   if ($rows != 0) {     /// data collecting      $q = "SELECT no FROM `staffphotos` Where no=$_clno";    if (!$db->Query($q)) $db->Kill();      $row=$db->Row();      $rows2 = $db->Rows();          $q = "SELECT `photo_alttext`, `photo_src`, `photo_desc`, `photo_filename`, `photo_filesize`, `photo_filetype` FROM `temp_nombers` WHERE `ID`=$ID;";   if (!$db->Query($q)) $db->Kill();    $no=$db->Row();    $alt=$no->photo_alttext;    $data=$no->photo_src;    $opis=$no->photo_desc;    $src_name=$no->photo_filename;    $src_size=$no->photo_filesize;    $src_type=$no->photo_filetype;        $data = addslashes($data);   $opis = addslashes($obis);             if ($rows2 == 0) {     // insert    $query = ("INSERT INTO `staffphotos` (  `no`, `photo_alttext`, `photo_src`, `photo_desc`, `photo_filename`, `photo_filesize`, `photo_filetype`) VALUES (  '$_clno','$alt', '$data', '$opis', '$src_name', '$src_size', '$src_type')") ;   if (!$db->Open()) $db->Kill();      }    else {    // update        $q = "UPDATE `staffphotos` SET `photo_alttext` = '$alt',`photo_src`= '$data', `photo_desc`= '$opis', `photo_filename`= '$src_name' ,`photo_filetype`= '$src_size',`photo_filetype`='$src_type' Where no ='$_clno' LIMIT 1";    if (!$db->Query($q)) $db->Kill();    }     echo "<script language='javascript'>window.location=\"stafflista_temp.php\"</script>";   }   else   echo "The Clocking number is bad!";  }   else echo "There is no Clocking number!";  }    // Delete    if ($_delete == "1") {      $q = "DELETE FROM `temp_nombers` WHERE `ID` = $ID LIMIT 1";    if (!$db->Query($q)) $db->Kill();              $q = "OPTIMIZE TABLE `temp_nombers` ";    if (!$db->Query($q)) $db->Kill();         echo "<script language='javascript'>window.location=\"stafflista_temp.php\"</script>";  }    } //fi state=1else{ echo "<BR><BR><BR>Ostrze¿enie!!!!!<BR><BR><BR>",	 "Ktos z komputera $REMOTE_ADDR probuje sie wlamac<BR>";} //else state?>